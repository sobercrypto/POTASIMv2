<!DOCTYPE html> 
<html>
<head>
    <title>SPUDNIK's Potato Game</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    
    <style>
        /* Your existing styles plus new store styles */
        body {
            font-family: system-ui, -apple-system, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(45deg, #f0f0f0, #e8f5e8);
            animation: backgroundShift 20s infinite;
        }

        @keyframes backgroundShift {
            0% { background: linear-gradient(45deg, #f0f0f0, #e8f5e8); }
            25% { background: linear-gradient(45deg, #e8f5e8, #f5f0e8); }
            50% { background: linear-gradient(45deg, #f5f0e8, #f0e8f5); }
            75% { background: linear-gradient(45deg, #f0e8f5, #e8f0f5); }
            100% { background: linear-gradient(45deg, #e8f0f5, #f0f0f0); }
        }

        .potato-game {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .potato-button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 4px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .potato-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
            background: linear-gradient(45deg, #45a049, #4CAF50);
        }

        .potato-slider {
            width: 100%;
            margin: 10px 0;
            appearance: none;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(to right, #4CAF50, #45a049);
            outline: none;
        }

        .potato-slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }

        .potato-timer {
            background: linear-gradient(45deg, #000, #333);
            color: #4CAF50;
            font-family: 'Courier New', monospace;
            font-size: 64px;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            text-shadow: 0 0 20px #4CAF50;
            border: 2px solid #4CAF50;
        }

        .potato-progress {
            width: 100%;
            height: 25px;
            background: rgba(240,240,240,0.8);
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }

        .potato-progress-bar {
            height: 100%;
            background: linear-gradient(45deg, #4CAF50, #45a049, #8BC34A);
            transition: width 0.1s ease;
            border-radius: 15px;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }

        .potato-alert {
            border-left: 4px solid #4CAF50;
            background: linear-gradient(45deg, rgba(227,242,253,0.9), rgba(240,248,255,0.9));
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            backdrop-filter: blur(5px);
        }

        .scenario-category {
            display: inline-block;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            margin: 5px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .potato-store-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .potato-store {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 25px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .store-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid rgba(76, 175, 80, 0.3);
            position: relative;
        }

        .coin-display {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
            text-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
        }

        .store-items {
            display: grid;
            gap: 20px;
        }

        .store-item {
            border: 2px solid rgba(238,238,238,0.8);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(5px);
        }

        .store-item:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            transform: translateY(-3px);
            border-color: #4CAF50;
        }

        .item-info {
            flex: 1;
        }

        .item-info h3 {
            margin: 0 0 8px 0;
            color: #333;
        }

        .item-info p {
            margin: 0 0 10px 0;
            color: #666;
            line-height: 1.4;
        }

        .item-cost {
            font-weight: bold;
            color: #4CAF50;
            font-size: 1.1em;
        }

        /* Additional styles */
        .utensil-tray {
            background: rgba(255,255,255,0.9);
            border-radius: 12px;
            padding: 20px;
            margin: 25px 0;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .utensils-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .utensil-item {
            border: 2px solid #eee;
            border-radius: 12px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(5px);
        }

        .utensil-item:hover {
            border-color: #4CAF50;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.2);
        }

        .utensil-used {
            border-color: #4CAF50;
            background: rgba(240,249,240,0.9);
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.3);
        }

        .utensil-disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .utensil-icon {
            font-size: 28px;
            margin-bottom: 12px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .utensil-name {
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }

        .utensil-description {
            font-size: 0.9em;
            color: #666;
            line-height: 1.3;
        }

        .utensil-status {
            position: absolute;
            top: 12px;
            right: 12px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
        }

        /* RGB Lighting Effect */
        @keyframes rgbBorder {
            0% { box-shadow: 0 0 20px rgba(255,0,0,0.6), inset 0 0 20px rgba(255,0,0,0.1); }
            33% { box-shadow: 0 0 20px rgba(0,255,0,0.6), inset 0 0 20px rgba(0,255,0,0.1); }
            66% { box-shadow: 0 0 20px rgba(0,0,255,0.6), inset 0 0 20px rgba(0,0,255,0.1); }
            100% { box-shadow: 0 0 20px rgba(255,0,0,0.6), inset 0 0 20px rgba(255,0,0,0.1); }
        }

        .rgb-enabled {
            animation: rgbBorder 3s infinite;
        }

        .potato-title {
            background: linear-gradient(45deg, #4CAF50, #45a049, #8BC34A);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .scenario-text {
            font-size: 1.1em;
            line-height: 1.6;
            color: #333;
            margin: 15px 0;
        }

        .hint-section {
            background: rgba(33, 150, 243, 0.1);
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-style: italic;
        }

        /* New Adventure Features Styles */
        .achievement-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(255, 215, 0, 0.5);
            animation: slideInRight 0.5s ease, pulse 2s infinite;
            z-index: 2000;
            max-width: 300px;
        }

        @keyframes slideInRight {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .campaign-bar {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .chapter-card {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(139, 195, 74, 0.1));
            border: 2px solid #4CAF50;
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
            transition: all 0.3s ease;
        }

        .chapter-card.locked {
            opacity: 0.5;
            border-color: #999;
            background: rgba(200, 200, 200, 0.1);
        }

        .chapter-card:hover:not(.locked) {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.3);
        }

        .companion-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .companion-card {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #eee;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .companion-card.selected {
            border-color: #4CAF50;
            background: rgba(240, 249, 240, 0.9);
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.4);
        }

        .companion-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .companion-card:hover:not(.locked) {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .random-event-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            z-index: 3000;
            max-width: 500px;
            animation: zoomIn 0.3s ease;
        }

        @keyframes zoomIn {
            from { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .event-choice-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.5);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            margin: 8px 0;
            width: 100%;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .event-choice-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.8);
            transform: translateX(5px);
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .achievement-card {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #eee;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .achievement-card.unlocked {
            border-color: #FFD700;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 165, 0, 0.1));
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        .achievement-card.locked {
            opacity: 0.5;
            filter: grayscale(100%);
        }

        .stats-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(76, 175, 80, 0.3);
        }

        .nav-tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            color: #666;
            transition: all 0.3s ease;
        }

        .nav-tab.active {
            color: #4CAF50;
            border-bottom-color: #4CAF50;
        }

        .nav-tab:hover {
            color: #4CAF50;
        }
    </style>
</head>
<body>
    <div id="potato-game-root"></div>

    <script type="text/babel">
        // MASSIVELY ENHANCED SCENARIO GENERATION SYSTEM
        // More scenario variety while keeping it grounded in potato reality

        const SCENARIO_TEMPLATES = {
            'Interdimensional Kitchen': [
                "A portal has opened in your kitchen, and beings from the {adjective} dimension of {place} have arrived demanding you prove your worth through potato mastery. They communicate only through {communication} and judge based on {judgement_criteria}. {stakes}",
                "Your kitchen has been invaded by {entity} from {timeperiod} who claims your {appliance} is actually a {mystical_object}. They'll only return to their realm if you can bake the perfect potato using ancient {technique} methods. {warning}",
                "Reality has glitched and your oven now exists in {dimension_count} dimensions simultaneously. The {authority_figure} from {fictional_place} needs you to stabilize spacetime by achieving perfect {measurement} resonance in your potato. {consequence}"
            ],
            'Corporate Potato Dystopia': [
                "You're the new intern at {corporation}, where potato-baking skills determine your {job_metric}. Your supervisor, {boss_character}, has given you {time_pressure} to impress {client} or face {corporate_punishment}. The company's {weird_policy} makes this extra challenging.",
                "The {business_type} you work for has been secretly {conspiracy} using potato-based {technology}. Your {colleague_type} has discovered that perfect potato baking can {world_changing_effect}, but the {opposition} is trying to stop you. {urgency}",
                "As a {job_title} in the post-apocalyptic {industry}, you must bake potatoes to {survival_goal}. The {resource} shortage means you only get one chance, and the {authority} will {punishment} if you fail. {environmental_hazard}"
            ],
            'Mystical Potato Prophecy': [
                "The ancient {mystical_text} prophesied that when {celestial_event} occurs, the chosen one will arise who can bake the {legendary_potato}. You've been visited by {magical_being} who insists you're the prophecy's fulfillment, but {obstacle} stands in your way. {mystical_consequence}",
                "Your {magical_appliance} has been possessed by the spirit of {historical_chef}, who can only be released if you recreate their legendary {signature_dish} from {historical_period}. The spirit keeps {interference} and time is running out before {dire_consequence}.",
                "A {magical_creature} has cursed your kitchen so that every potato you bake will {curse_effect} unless you can achieve perfect {mystical_measurement} harmony. The curse can only be broken during {time_constraint}, and failure means {curse_escalation}."
            ],
            'Scientific Potato Experiment': [
                "Dr. {scientist_name} has recruited you for {experiment_type} involving potato thermal dynamics. The {scientific_equipment} is calibrated to measure {measurement_unit}, and achieving perfect results could {scientific_breakthrough}. However, {lab_hazard} threatens the experiment. {pressure}",
                "Your potato has been selected for the {space_program} as part of humanity's first {mission_type}. The {space_agency} needs perfect {space_criteria} to ensure {mission_success}. Astronaut {astronaut_name} is counting on you, but {space_obstacle} complicates everything.",
                "The {research_facility} has discovered that potato cooking patterns can predict {phenomenon}. You're the test subject for their {device_name}, which will {measurement_method} your baking process. Success could {world_benefit}, but failure might {science_disaster}."
            ],
            'Time-Displaced Potato Crisis': [
                "You've accidentally time-traveled to {historical_period} and must convince {historical_figure} that you're not a {accused_crime} by demonstrating your {skill_type} through potato mastery. The locals think your {modern_thing} is {period_appropriate_fear}, and {time_pressure} before {historical_consequence}.",
                "A time traveler from {future_period} has arrived claiming that your potato-baking technique will {future_impact} in their timeline. They've brought {futuristic_equipment} to help, but using it incorrectly could {temporal_disaster}. {future_authority} is {emotion} watching.",
                "Your {time_device} malfunctioned during a baking session, creating a {temporal_anomaly} where you must bake the same potato across {number} different time periods simultaneously. Each era's {cultural_representative} has different {cultural_requirement}, and failure means {temporal_consequence}."
            ],
            'Alien Potato Encounter': [
                "First contact has been made, and the {alien_species} from {planet} communicate exclusively through {alien_communication}. Their {alien_leader} has declared that humanity's worth will be judged by your ability to bake a potato using their {alien_technology}. They find our {human_thing} {alien_reaction}, and {contact_stakes}.",
                "Your potato has been replaced with a {alien_artifact} by {alien_faction} who are {alien_mission}. The only way to {resolution_method} is to treat it exactly like a normal potato while secretly {hidden_action}. The {alien_detector} will {detection_consequence} if you're discovered.",
                "An intergalactic {competition_type} has chosen Earth as its next venue, and you've been randomly selected to represent humanity in the {event_name}. The {alien_judge} species evaluates based on {alien_criteria}, and losing means {planetary_consequence}. Your {alien_coach} keeps giving contradictory advice."
            ],
            'Supernatural Potato Drama': [
                "Your {deceased_relative} has returned as a {ghost_type} and will only move on to the afterlife if you can recreate their secret {recipe_type} from memory. They can only communicate by {ghostly_communication}, and every mistake causes {supernatural_effect}. The {supernatural_authority} gives you until {time_limit}.",
                "A {demon_type} has possessed your {kitchen_appliance} and demands {demonic_payment} in exchange for perfect potato cooking. The {religious_figure} warned you that accepting help will {moral_consequence}, but refusing means {failure_result}. {supernatural_complication} makes everything more urgent.",
                "Your neighborhood has been cursed by {supernatural_entity} so that everyone's cooking fails except when perfect harmony is achieved. You're the last hope to break the curse by baking a potato with {supernatural_requirement}. The {cursed_effect} grows stronger each day, and {community_pressure} is mounting."
            ]
        };

        const RANDOM_ELEMENTS = {
            adjective: ['crystalline', 'backwards', 'musical', 'geometric', 'liquid', 'transparent', 'inverted', 'microscopic', 'elastic', 'magnetic'],
            place: ['Spud-37', 'the Tuber Nebula', 'New Potatopia', 'the Root Dimension', 'Starch Valley', 'the Great Baking', 'Flavor Town Prime', 'the Crispy Realm', 'Umami Central', 'the Deep Fry'],
            communication: ['interpretive dance', 'potato-scented smoke signals', 'mathematical equations', 'temperature fluctuations', 'color changes', 'musical frequencies', 'enzyme secretions', 'quantum entanglement'],
            judgement_criteria: ['texture resonance', 'molecular harmony', 'temporal consistency', 'dimensional stability', 'flavor wavelength', 'cooking rhythm', 'thermal poetry', 'starch architecture'],
            stakes: ['Their invasion fleet waits in orbit.', 'Reality itself hangs in the balance!', 'Your kitchen might collapse into a flavor void.', 'Time could fold in on itself!'],
            entity: ['the Ghost of Julia Child', 'interdimensional food critics', 'sentient kitchen utensils', 'time-displaced master chefs', 'AI food bloggers from 2087'],
            timeperiod: ['the Potato Renaissance', '3021 CE', 'the Great Tuber War', 'ancient Mesopotamia', 'the Steam Age', 'peak civilization', 'the before-times'],
            appliance: ['oven', 'microwave', 'toaster', 'air fryer', 'slow cooker', 'pressure cooker'],
            mystical_object: ['portal generator', 'time anchor', 'dimensional stabilizer', 'reality compiler', 'universe printer', 'chaos engine'],
            technique: ['crystalline resonance', 'quantum tunneling', 'thermal meditation', 'molecular dancing', 'entropy reversal', 'flavor alchemy'],
            warning: ['The fabric of reality grows thin!', 'Strange energies build in your kitchen!', 'Time itself grows impatient!'],
            dimension_count: ['seventeen', 'infinite', 'negative two', 'imaginary', 'fractal', 'recursive'],
            authority_figure: ['Potato Pope', 'Thermal Emperor', 'Starch Magistrate', 'Root Chancellor', 'Tuber Overlord'],
            fictional_place: ['the Flavor Dimension', 'Umami Prime', 'New Crispington', 'the Spud Collective', 'Thermal City'],
            measurement: ['thermal', 'flavor', 'textural', 'temporal', 'dimensional', 'molecular'],
            consequence: ['Kitchen spacetime could collapse!', 'Reality might reboot!', 'All potatoes could achieve sentience!'],
            corporation: ['SynerTech Solutions', 'Global Flavor Industries', 'Quantum Cuisine Corp', 'ThermalDyne Systems', 'OmniTuber Ltd', 'Starch Innovations Inc'],
            job_metric: ['quarterly performance', 'caloric efficiency rating', 'thermal optimization score', 'flavor proficiency index', 'employee nutrition rating'],
            boss_character: ['Karen from Accounting', 'the Thermal Efficiency Manager', 'Dr. Corporate McSynergy', 'your AI supervisor BAKE-3000', 'the mysterious CEO who only communicates through potato ratings'],
            time_pressure: ['exactly 47 minutes', 'until the board meeting', 'before the office lunch rush', 'until the quarterly review', 'before the surprise inspection'],
            client: ['the Pentagon', 'visiting investors', 'the International Potato Council', 'mysterious government agents', 'your company\'s AI overlord'],
            corporate_punishment: ['mandatory team-building retreat', 'permanent coffee duty', 'transfer to the basement filing department', 'deletion from the employee database', 'assignment to the Mars colony'],
            weird_policy: ['potato-based employee evaluations', 'mandatory thermal meditation', 'competitive cooking clause in your contract', 'office potato purity standards', 'synchronized lunch policy'],
            mystical_text: ['Cookbook of Shadows', 'Thermal Prophecies', 'the Starch Scrolls', 'Ancient Recipe Codex', 'the Forbidden Kitchen Manual'],
            celestial_event: ['the Great Alignment', 'solar maximum', 'the Potato Eclipse', 'Mercury retrograde', 'the convergence of all ovens'],
            legendary_potato: ['Golden Tuber of Destiny', 'the Perfect Spud', 'the Eternal Russet', 'the Chosen Fingerling', 'the Ultimate Yukon'],
            magical_being: ['the Potato Fairy', 'ancient Kitchen Spirit', 'sentient recipe book', 'ghost of your grandmother', 'interdimensional chef'],
            obstacle: ['your oven is cursed', 'the ingredients keep disappearing', 'time runs backwards in your kitchen', 'gravity doesn\'t work properly'],
            mystical_measurement: ['thermal', 'flavor', 'textural', 'spiritual', 'emotional', 'dimensional'],
            time_constraint: ['the next full moon', 'before midnight', 'during the eclipse', 'within the hour', 'before dawn'],
            curse_escalation: ['permanent kitchen banishment', 'all food turns to ash', 'culinary amnesia', 'flavor blindness'],
            magical_appliance: ['oven', 'microwave', 'toaster', 'air fryer', 'food processor', 'blender'],
            historical_chef: ['Auguste Escoffier', 'Julia Child', 'Marco Pierre White', 'Anthony Bourdain', 'Gordon Ramsay', 'Wolfgang Puck'],
            signature_dish: ['legendary soufflÃ©', 'perfect risotto', 'mystical coq au vin', 'transcendent beef wellington', 'divine ratatouille'],
            historical_period: ['1920s Paris', 'medieval times', 'the Renaissance', 'ancient Rome', 'the Wild West'],
            interference: ['rearranging your ingredients', 'changing your oven temperature', 'whispering doubts', 'possessing your utensils', 'flickering the lights ominously'],
            dire_consequence: ['eternal haunting', 'a culinary curse spreads', 'the kitchen dimension collapses', 'all recipes become lost forever'],
            scientist_name: ['Dr. Cornelius Spudsworth', 'Professor Heat Transfer', 'Dr. Therma Dynamics', 'Captain Science', 'Dr. Starchy McStarchface'],
            experiment_type: ['classified government research', 'Nobel Prize-worthy studies', 'secret corporate development', 'interdimensional cooking science'],
            scientific_breakthrough: ['solve world hunger', 'unlock infinite energy', 'cure all diseases', 'achieve world peace', 'discover time travel'],
            historical_figure: ['Napoleon Bonaparte', 'Leonardo da Vinci', 'Cleopatra', 'Einstein', 'Marie Curie', 'Shakespeare'],
            accused_crime: ['witch', 'time spy', 'flavor thief', 'thermal terrorist', 'kitchen demon'],
            alien_species: ['Thermoplastics', 'the Starch Collective', 'Flavor Parasites', 'the Crispy Ones', 'Temperature Beings'],
            planet: ['Potaturn', 'the Thermal Nebula', 'Starch-7', 'the Root System', 'Flavor Prime'],
            ghost_type: ['confused spirit', 'culinary poltergeist', 'thermal ghost', 'recipe wraith', 'kitchen phantom'],
            deceased_relative: ['great-grandmother', 'mysterious uncle', 'family chef', 'potato-obsessed ancestor'],
            supernatural_entity: ['the Starch Demon', 'Kitchen Curse Sprite', 'the Burnt Offering', 'Thermal Poltergeist'],
            magical_creature: ['kitchen gremlin', 'culinary imp', 'stove spirit', 'oven demon', 'thermal fairy'],
            curse_effect: ['taste like cardboard', 'turn purple', 'scream when bitten', 'multiply endlessly', 'disappear randomly'],
            business_type: ['tech startup', 'consulting firm', 'pharmaceutical company', 'defense contractor', 'social media platform'],
            conspiracy: ['mind control experiments', 'alien communication attempts', 'reality manipulation studies', 'time travel research', 'consciousness uploading'],
            technology: ['neural networks', 'quantum computers', 'fusion reactors', 'teleportation devices', 'mind reading machines'],
            space_program: ['Mars colonization mission', 'deep space exploration', 'asteroid mining operation', 'space station construction', 'alien contact protocol'],
            mission_type: ['interstellar journey', 'lunar base establishment', 'Jupiter exploration', 'black hole study', 'wormhole investigation'],
            // Missing elements that were causing placeholder issues
            colleague_type: ['paranoid coworker', 'whistleblower scientist', 'secret agent', 'time traveler', 'AI researcher'],  
            world_changing_effect: ['solve world hunger', 'achieve world peace', 'unlock time travel', 'cure all diseases', 'create infinite energy'],
            opposition: ['corporate security', 'government agents', 'rival scientists', 'time police', 'alien infiltrators'],
            urgency: ['You have one hour before they discover the truth!', 'The board meeting is in 30 minutes!', 'Reality is collapsing!'],
            job_title: ['Senior Potato Analyst', 'Thermal Engineer', 'Corporate Intern', 'Kitchen Specialist', 'Survival Expert'],
            industry: ['food service sector', 'technology industry', 'space exploration', 'underground bunkers', 'corporate wasteland'],
            survival_goal: ['feed the last survivors', 'maintain morale', 'prove your worth', 'unlock the food vault', 'appease the overlords'],
            resource: ['electricity', 'clean water', 'proper seasoning', 'working ovens', 'edible potatoes'],
            authority: ['Potato Council', 'Wasteland Chief', 'Corporate Overlord', 'AI Governor', 'Survival Committee'],
            punishment: ['exile you', 'reduce your rations', 'send you to the mines', 'delete your existence', 'feed you to the mutants'],
            environmental_hazard: ['Radiation storms approach!', 'The bunker is flooding!', 'Oxygen levels are dropping!'],
            mystical_consequence: ['The prophecy will remain unfulfilled!', 'Darkness will consume the kitchen!', 'The cosmic balance will shatter!'],
            scientific_equipment: ['thermal spectrometer', 'quantum oven', 'molecular analyzer', 'heat detection array', 'precision instruments'],
            measurement_unit: ['thermal flux', 'molecular density', 'flavor wavelengths', 'starch crystallization', 'quantum resonance'],
            lab_hazard: ['radiation exposure', 'equipment malfunction', 'containment breach', 'temporal anomaly', 'system overload'],
            pressure: ['The Nobel Committee is watching!', 'Funding depends on success!', 'The experiment cannot fail!'],
            space_agency: ['NASA', 'SpaceX', 'the Mars Colony Initiative', 'Intergalactic Command', 'the Space Consortium'],
            space_criteria: ['zero-gravity consistency', 'radiation resistance', 'perfect thermal distribution', 'psychological comfort', 'long-term preservation'],
            mission_success: ['crew survival', 'colony establishment', 'first contact', 'scientific breakthrough', 'humanity\'s future'],
            astronaut_name: ['Commander Sarah Chen', 'Captain Mike Rodriguez', 'Dr. Elena Volkov', 'Major John Smith', 'Lieutenant Amy Park'],
            space_obstacle: ['solar flares', 'equipment failure', 'alien interference', 'cosmic radiation', 'system malfunction'],
            research_facility: ['MIT Labs', 'CERN', 'Area 51', 'the Institute', 'Corporate R&D'],
            phenomenon: ['stock market crashes', 'natural disasters', 'election outcomes', 'climate changes', 'social trends'],
            device_name: ['the Predictotron', 'Quantum Analyzer', 'Future-Vision Machine', 'Thermal Oracle', 'Pattern Recognition Engine'],
            measurement_method: ['scan the thermal patterns of', 'analyze the molecular structure of', 'record the quantum signature of', 'measure the dimensional resonance of'],
            world_benefit: ['prevent disasters', 'cure diseases', 'solve poverty', 'achieve world peace', 'unlock the future'],
            science_disaster: ['tear reality', 'create paradoxes', 'destroy the timeline', 'collapse dimensions', 'break causality'],
            skill_type: ['culinary mastery', 'thermal expertise', 'cooking prowess', 'food preparation', 'kitchen skills'],
            modern_thing: ['digital thermometer', 'timer app', 'aluminum foil', 'electric oven', 'precise measurements'],
            period_appropriate_fear: ['witchcraft', 'devil magic', 'foreign sorcery', 'divine punishment', 'technological heresy'],
            historical_consequence: ['being burned as a witch', 'exile from the kingdom', 'imprisonment', 'execution', 'becoming a social outcast'],
            future_period: ['2157', '3021', 'the year 4000', 'the post-singularity era', 'the age of AI'],
            future_impact: ['save humanity', 'prevent the robot wars', 'cure the great famine', 'restore Earth\'s climate', 'unlock interdimensional travel'],
            futuristic_equipment: ['quantum oven enhancer', 'temporal stabilizer', 'molecular reconstructor', 'reality anchor', 'dimension calibrator'],
            temporal_disaster: ['erase yourself from history', 'create a paradox', 'destroy the timeline', 'split reality', 'collapse spacetime'],
            future_authority: ['the AI Council', 'Time Command', 'the Future Government', 'Temporal Oversight', 'the Machine Collective'],
            emotion: ['nervously', 'hopefully', 'anxiously', 'desperately', 'cautiously'],
            time_device: ['time machine', 'temporal portal', 'chronometer', 'dimension hopper', 'reality shifter'],
            temporal_anomaly: ['time loop', 'causal paradox', 'temporal rift', 'chronological displacement', 'dimensional instability'],
            number: ['three', 'seven', 'twelve', 'infinite', 'seventeen'],
            cultural_representative: ['village elder', 'court chef', 'food critic', 'royal taster', 'cultural ambassador'],
            cultural_requirement: ['ritual preparation', 'specific seasonings', 'traditional methods', 'ceremonial presentation', 'spiritual blessing'],
            temporal_consequence: ['permanent time displacement', 'erasure from history', 'temporal imprisonment', 'causal loop', 'timeline collapse'],
            alien_communication: ['thermal fluctuations', 'color patterns', 'mathematical equations', 'scent molecules', 'vibrational frequencies'],
            alien_leader: ['High Thermal Commander', 'Supreme Starch Entity', 'Chief Flavor Inspector', 'Prime Minister of Taste', 'Emperor of Temperature'],
            alien_technology: ['quantum thermal manipulator', 'molecular flavor enhancer', 'dimensional oven', 'telepathic cooking interface', 'reality-bending seasonings'],
            human_thing: ['use of fire', 'obsession with temperature', 'inefficient cooking methods', 'primitive ovens', 'emotional attachment to food'],
            alien_reaction: ['hilariously primitive', 'surprisingly advanced', 'utterly baffling', 'strangely appealing', 'deeply concerning'],
            contact_stakes: ['first impressions matter for all humanity', 'they\'ll destroy Earth if disappointed', 'this determines our species\' fate', 'galactic membership hangs in the balance'],
            alien_artifact: ['crystalline potato substitute', 'interdimensional tuber', 'quantum food sample', 'synthetic earth vegetable', 'test specimen from their labs'],
            alien_faction: ['the Taste Testers', 'Culinary Researchers', 'Food Quality Inspectors', 'the Flavor Council', 'Thermal Investigators'],
            alien_mission: ['studying human food culture', 'testing our worthiness', 'gathering data on Earth cuisine', 'preparing for invasion', 'conducting flavor experiments'],
            resolution_method: ['pass their test', 'prove human worth', 'satisfy their curiosity', 'demonstrate cooking skill', 'earn their respect'],
            hidden_action: ['sending distress signals', 'recording their technology', 'calling for backup', 'documenting everything', 'preparing defenses'],
            alien_detector: ['thermal scanner', 'deception sensor', 'truth analyzer', 'emotional reader', 'intention probe'],
            detection_consequence: ['immediate vaporization', 'planetary destruction', 'species enslavement', 'memory erasure', 'exile to deep space'],
            competition_type: ['cooking championship', 'culinary Olympics', 'flavor contest', 'thermal mastery trial', 'galactic food games'],
            event_name: ['Ultimate Potato Challenge', 'Intergalactic Cooking Championship', 'Universal Food Contest', 'Cosmic Culinary Competition', 'Stellar Starch Showdown'],
            alien_judge: ['Silicon-based', 'Methane-breathing', 'Energy-being', 'Crystalline', 'Gaseous'],
            alien_criteria: ['molecular harmony', 'thermal perfection', 'flavor wavelength', 'cooking aura', 'taste transcendence'],
            planetary_consequence: ['Earth becomes their food source', 'humanity faces extinction', 'we become galactic laughingstock', 'planet gets quarantined', 'forced relocation to Mars'],
            alien_coach: ['defected alien chef', 'sympathetic food critic', 'reformed taste tester', 'rebel culinary expert', 'exiled flavor master'],
            recipe_type: ['potato dish', 'family recipe', 'secret formula', 'legendary meal', 'traditional preparation'],
            ghostly_communication: ['knocking on walls', 'flickering lights', 'moving utensils', 'temperature changes', 'appearing in steam'],
            supernatural_effect: ['kitchen utensils fly around', 'ingredients spoil instantly', 'the oven temperature changes', 'mysterious smoke appears', 'unexplained sounds occur'],
            supernatural_authority: ['the Grim Reaper', 'Angel of Cooking', 'Kitchen Spirit Guide', 'Culinary Council of the Dead', 'Department of Lost Souls'],
            time_limit: ['midnight', 'dawn', 'the next full moon', 'before sunrise', 'within the hour'],
            demon_type: ['kitchen demon', 'culinary imp', 'thermal fiend', 'stove spirit', 'oven devil'],
            kitchen_appliance: ['oven', 'microwave', 'toaster', 'blender', 'food processor'],
            demonic_payment: ['your first-born recipe', 'eternal kitchen servitude', 'your soul', 'perfect cooking forever', 'your ability to taste'],
            religious_figure: ['the local priest', 'your grandmother', 'a wise monk', 'the kitchen exorcist', 'a spiritual advisor'],
            moral_consequence: ['damn your soul', 'curse your cooking forever', 'trap you in the kitchen', 'steal your humanity', 'corrupt your food'],
            failure_result: ['permanent bad cooking', 'kitchen haunting', 'cursed meals', 'culinary disasters', 'food poisoning everything'],
            supernatural_complication: ['a second demon appears', 'the kitchen catches ethereal fire', 'reality starts glitching', 'other appliances become possessed', 'a portal opens'],
            supernatural_requirement: ['perfect spiritual harmony', 'absolute thermal balance', 'pure cooking intention', 'flawless execution', 'divine blessing'],
            cursed_effect: ['everyone\'s food tastes terrible', 'all meals burn instantly', 'ingredients rot immediately', 'cooking becomes impossible', 'kitchens spontaneously combust'],
            community_pressure: ['the whole neighborhood is depending on you', 'everyone is watching', 'you\'re their last hope', 'the mayor has called an emergency meeting', 'news crews have arrived']
        };

        // Enhanced scenario generation using Claude API with varied prompts
            const generateScenario = async () => {
                try {
                    // Different prompt variations to add variety
                    const promptVariations = [
                        "Generate a quirky FAMILY DRAMA scenario for a potato baking game where family dynamics and relationships are at stake. Include both the scenario and potential outcomes.",
                        "Create a FOOD COMPETITION scenario for a potato baking game with high stakes, dramatic judges, or cooking show elements. Include both the scenario and potential outcomes.",
                        "Design a HISTORICAL scenario for a potato baking game involving time travel, period-specific characters, or historical figures. Include both the scenario and potential outcomes.",
                        "Invent a SCIENTIFIC scenario for a potato baking game involving experiments, research, space missions, or laboratory settings. Include both the scenario and potential outcomes.",
                        "Make a SOCIAL EVENT scenario for a potato baking game with parties, dates, gatherings, or important social situations. Include both the scenario and potential outcomes.",
                        "Create a MAGICAL MISHAP scenario for a potato baking game with supernatural elements, curses, ghosts, or mystical beings. Include both the scenario and potential outcomes.",
                        "Generate a WORKPLACE scenario for a potato baking game set in a corporate, office, or professional environment with career stakes. Include both the scenario and potential outcomes.",
                        "Design an ALIEN ENCOUNTER scenario for a potato baking game involving extraterrestrials, first contact, or intergalactic situations. Include both the scenario and potential outcomes."
                    ];
            
                    // Random elements to add to prompts for extra variety
                    const randomElements = [
                        "involving time pressure", "with unexpected characters", "featuring talking objects", 
                        "in an unusual location", "with a mystery element", "during a crisis",
                        "with a cooking competition twist", "featuring supernatural elements", "in a futuristic setting",
                        "with family secrets", "involving a bet or wager", "with professional stakes",
                        "featuring celebrity appearances", "with a romantic subplot", "involving ancient recipes"
                    ];
            
                    const randomPrompt = promptVariations[Math.floor(Math.random() * promptVariations.length)];
                    const randomElement = randomElements[Math.floor(Math.random() * randomElements.length)];
            
                    console.log('Making API request...');
            
                    const response = await fetch('/api/proxy', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            max_tokens: 1024,
                            messages: [{
                                role: "user",
                                content: `${randomPrompt} ${randomElement}. Use this exact JSON format:
                                {
                                    "description": "[2-3 sentences describing an amusing and overly specific situation involving potato baking. Make it dramatic and absurd while keeping it grounded in the premise that this is just about baking a potato. Mix everyday situations with high stakes consequences.]",
                                    "category": "[one of: 'Family Drama', 'Food Competition', 'Historical', 'Scientific', 'Social Event', 'Magical Mishap', 'Workplace', 'Alien Encounter']",
                                    "idealTemp": [temperature between 350-450],
                                    "idealTime": [cooking time between 20-90 minutes],
                                    "idealSize": [1 for small, 2 for medium, 3 for large],
                                    "hint": "[a clever cooking tip that relates to the scenario's story]",
                                    "outcomes": {
                                        "perfect": "[enthusiastic response from the characters when the potato is perfect]",
                                        "good": "[positive but not perfect reaction]",
                                        "okay": "[humorous slightly disappointed reaction]",
                                        "burnt": "[funny disaster reaction]",
                                        "raw": "[comedic failure reaction]"
                                    }
                                }`
                            }]
                        })
                    });
                    
                    console.log('Response status:', response.status);
                    console.log('Response ok:', response.ok);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    console.log('Full API Response:', data);
                    
                    if (!data.content || !data.content[0] || !data.content[0].text) {
                        console.error('Unexpected response structure:', data);
                        throw new Error('Unexpected API response structure');
                    }
            
                    const contentText = data.content[0].text;
                    console.log('Content text:', contentText);
                    
                    // Remove markdown code blocks if present
                    let cleanedText = contentText.trim();
                    if (cleanedText.startsWith('```json')) {
                        cleanedText = cleanedText.replace(/^```json\s*/, '').replace(/```\s*$/, '');
                    } else if (cleanedText.startsWith('```')) {
                        cleanedText = cleanedText.replace(/^```\s*/, '').replace(/```\s*$/, '');
                    }
                    
                    const parsedJSON = JSON.parse(cleanedText.trim());
                    console.log('Parsed scenario:', parsedJSON);
                    
                    return parsedJSON;
            
                } catch (error) {
                    console.error('Error generating scenario:', error);
                    return {
                        description: "Your time-traveling grandmother has arrived from 1952 to judge your potato-baking skills against her famous recipe. She's brought her antique potato-rating kit and a very strong opinion about 'how things were done in her day.'",
                        category: "Historical",
                        idealTemp: 425,
                        idealTime: 60,
                        idealSize: 2,
                        hint: "Remember, vintage recipes often used a pat of butter under the skin!",
                        outcomes: {
                            perfect: "Grandma tears up with joy: 'Just like I remember! You're officially keeper of the family potato tradition!'",
                            good: "Grandma nods approvingly: 'Almost as good as mine in '52. Almost.'",
                            okay: "Grandma sighs: 'Well, at least you didn't use that newfangled microwave...'",
                            burnt: "Grandma pulls out her time-travel remote: 'I'm going back to teach your mother how to cook properly.'",
                            raw: "Grandma shakes her head: 'In my day, we knew how to preheat an oven!'"
                        }
                    };
                }
            };

        // CAMPAIGN CHAPTERS - The SPUDNIK Saga
        const CAMPAIGN_CHAPTERS = [
            {
                id: 1,
                name: "The Awakening",
                description: "Your first encounter with interdimensional potato consciousness",
                requiredBakes: 0,
                reward: 50,
                unlocked: true
            },
            {
                id: 2,
                name: "Thermal Apprentice",
                description: "Master the basics of quantum tuber manipulation",
                requiredBakes: 3,
                reward: 100,
                unlocked: false
            },
            {
                id: 3,
                name: "Dimensional Drift",
                description: "Navigate the unstable potato multiverse",
                requiredBakes: 7,
                reward: 150,
                unlocked: false
            },
            {
                id: 4,
                name: "The Starch Wars",
                description: "Face the greatest potato challenges across spacetime",
                requiredBakes: 12,
                reward: 250,
                unlocked: false
            },
            {
                id: 5,
                name: "SPUDNIK Ascension",
                description: "Become one with the cosmic potato consciousness",
                requiredBakes: 20,
                reward: 500,
                unlocked: false
            }
        ];

        // POTATO COMPANIONS - Collectible friends!
        const POTATO_COMPANIONS = [
            {
                id: 'russet',
                name: 'Russet the Wise',
                emoji: 'ð¥',
                description: 'Ancient potato sage from the Old Tuber dimension',
                bonus: '+10% SpudCoins',
                cost: 150,
                unlockRequirement: 'Complete Chapter 1'
            },
            {
                id: 'fingerling',
                name: 'Fingerling the Fast',
                emoji: 'ð¥',
                description: 'Speedy spud who mastered temporal acceleration',
                bonus: '15% faster cooking',
                cost: 200,
                unlockRequirement: 'Complete Chapter 2'
            },
            {
                id: 'sweet',
                name: 'Sweet Potato Soul',
                emoji: 'ð ',
                description: 'Mystical tuber with healing properties',
                bonus: 'Second chance on failures',
                cost: 300,
                unlockRequirement: 'Complete Chapter 3'
            },
            {
                id: 'purple',
                name: 'Purple Majesty',
                emoji: 'ð£',
                description: 'Royal potato from the Indigo Dimension',
                bonus: '+5Â°F temperature precision',
                cost: 400,
                unlockRequirement: 'Complete Chapter 4'
            },
            {
                id: 'cosmic',
                name: 'Cosmic Spudnik Jr.',
                emoji: 'ð',
                description: 'SPUDNIK\'s apprentice from the future',
                bonus: 'All bonuses combined!',
                cost: 1000,
                unlockRequirement: 'Complete Chapter 5'
            }
        ];

        // ACHIEVEMENTS SYSTEM
        const ACHIEVEMENTS = [
            {
                id: 'first_bake',
                name: 'First Potato',
                description: 'Complete your first interdimensional bake',
                emoji: 'ð¥',
                reward: 25,
                condition: (stats) => stats.totalBakes >= 1
            },
            {
                id: 'perfect_master',
                name: 'Perfection Achieved',
                description: 'Get a perfect score',
                emoji: 'â­',
                reward: 50,
                condition: (stats) => stats.perfectBakes >= 1
            },
            {
                id: 'streak_3',
                name: 'On Fire!',
                description: 'Get 3 perfect bakes in a row',
                emoji: 'ð¥',
                reward: 100,
                condition: (stats) => stats.currentStreak >= 3
            },
            {
                id: 'streak_5',
                name: 'Unstoppable',
                description: 'Get 5 perfect bakes in a row',
                emoji: 'ð«',
                reward: 200,
                condition: (stats) => stats.currentStreak >= 5
            },
            {
                id: 'explorer',
                name: 'Dimensional Explorer',
                description: 'Complete all 8 scenario categories',
                emoji: 'ð',
                reward: 300,
                condition: (stats) => stats.categoriesCompleted >= 8
            },
            {
                id: 'rich',
                name: 'Spud Tycoon',
                description: 'Accumulate 1000 SpudCoins',
                emoji: 'ð°',
                reward: 150,
                condition: (stats) => stats.totalCoinsEarned >= 1000
            },
            {
                id: 'collector',
                name: 'Tool Master',
                description: 'Use all 4 utensils in a single bake',
                emoji: 'ð ï¸',
                reward: 75,
                condition: (stats) => stats.allUtensilsUsed >= 1
            },
            {
                id: 'veteran',
                name: 'Potato Veteran',
                description: 'Complete 25 bakes',
                emoji: 'ðï¸',
                reward: 250,
                condition: (stats) => stats.totalBakes >= 25
            },
            {
                id: 'speed_demon',
                name: 'Speed Demon',
                description: 'Complete a bake in under 20 minutes',
                emoji: 'â¡',
                reward: 100,
                condition: (stats) => stats.fastestBake > 0 && stats.fastestBake <= 20
            },
            {
                id: 'patient',
                name: 'Patience is a Virtue',
                description: 'Complete a bake over 80 minutes',
                emoji: 'ð§',
                reward: 100,
                condition: (stats) => stats.slowestBake >= 80
            }
        ];

        // RANDOM EVENTS during cooking
        const RANDOM_EVENTS = [
            {
                id: 'portal',
                title: 'ð Portal Anomaly Detected!',
                description: 'A dimensional rift is affecting your oven temperature!',
                choices: [
                    { text: 'Increase temperature by 50Â°F', effect: 'temp_up' },
                    { text: 'Decrease temperature by 50Â°F', effect: 'temp_down' },
                    { text: 'Maintain stability (do nothing)', effect: 'none' }
                ]
            },
            {
                id: 'time_warp',
                title: 'â° Time Anomaly!',
                description: 'Time is flowing strangely in your kitchen!',
                choices: [
                    { text: 'Speed up time (reduce by 10 min)', effect: 'time_down' },
                    { text: 'Slow down time (add 10 min)', effect: 'time_up' },
                    { text: 'Let time flow naturally', effect: 'none' }
                ]
            },
            {
                id: 'spudnik_visit',
                title: 'ð¸ SPUDNIK Appears!',
                description: 'The cosmic potato entity offers mysterious guidance!',
                choices: [
                    { text: 'Accept cosmic wisdom (+hint)', effect: 'hint' },
                    { text: 'Politely decline', effect: 'none' },
                    { text: 'Ask for bonus coins', effect: 'coins' }
                ]
            },
            {
                id: 'quantum_fluctuation',
                title: 'âï¸ Quantum Fluctuation!',
                description: 'Your potato exists in multiple states simultaneously!',
                choices: [
                    { text: 'Observe the potato (collapse waveform)', effect: 'reveal_progress' },
                    { text: 'Let quantum magic happen', effect: 'random_bonus' },
                    { text: 'Embrace the uncertainty', effect: 'none' }
                ]
            },
            {
                id: 'alien_inspection',
                title: 'ð½ Alien Food Inspector!',
                description: 'A curious alien is observing your cooking technique!',
                choices: [
                    { text: 'Show off your skills (+confidence)', effect: 'confidence' },
                    { text: 'Get nervous (-temperature)', effect: 'nervous' },
                    { text: 'Ignore them', effect: 'none' }
                ]
            }
        ];

        // Store items configuration
        const STORE_ITEMS = [
            {
                id: 'rgbLights',
                name: 'Interdimensional RGB Lighting',
                cost: 100,
                description: 'Adds cosmic RGB effects that sync with the potato dimension!',
            },
            {
                id: 'precisionControl',
                name: 'Quantum Precision Control',
                cost: 200,
                description: 'Thermal accuracy enhanced by quantum tuber mechanics (Â±2Â°F)',
            },
            {
                id: 'quickPreheat',
                name: 'Warp Speed Preheat',
                cost: 300,
                description: 'Channels interdimensional energy for 40% faster preheating',
            },
            {
                id: 'autoTimer',
                name: 'SPUDNIK AI Timer',
                cost: 400,
                description: 'AI-powered timing suggestions based on potato consciousness patterns',
            },
            {
                id: 'potatoVision',
                name: 'Thermal Potato Vision',
                cost: 500,
                description: 'See through the eyes of the potato itself during cooking',
            },
            {
                id: 'cosmicResonance',
                name: 'Cosmic Tuber Resonance',
                cost: 750,
                description: 'Align your oven with the universal potato frequency',
            }
        ];

        // Achievement Notification Component
        const AchievementNotification = ({ achievement, onClose }) => {
            React.useEffect(() => {
                const timer = setTimeout(onClose, 4000);
                return () => clearTimeout(timer);
            }, []);

            return (
                <div className="achievement-notification">
                    <h3 style={{ margin: '0 0 10px 0' }}>ð Achievement Unlocked!</h3>
                    <div style={{ fontSize: '32px', margin: '10px 0' }}>{achievement.emoji}</div>
                    <h4 style={{ margin: '5px 0' }}>{achievement.name}</h4>
                    <p style={{ margin: '5px 0', fontSize: '14px' }}>{achievement.description}</p>
                    <p style={{ fontWeight: 'bold', margin: '10px 0 0 0' }}>+{achievement.reward} SpudCoins! ð¥</p>
                </div>
            );
        };

        // Random Event Modal Component
        const RandomEventModal = ({ event, onChoice, temperature, time }) => {
            return (
                <React.Fragment>
                    <div className="potato-store-overlay" />
                    <div className="random-event-modal">
                        <h2 style={{ margin: '0 0 15px 0', fontSize: '24px' }}>{event.title}</h2>
                        <p style={{ margin: '0 0 20px 0', fontSize: '16px' }}>{event.description}</p>
                        <div style={{ marginBottom: '15px', padding: '10px', background: 'rgba(255,255,255,0.1)', borderRadius: '8px' }}>
                            <div>Current Temp: {temperature}Â°F</div>
                            <div>Current Time: {time} min</div>
                        </div>
                        <div>
                            {event.choices.map((choice, idx) => (
                                <button
                                    key={idx}
                                    className="event-choice-btn"
                                    onClick={() => onChoice(choice.effect)}
                                >
                                    {choice.text}
                                </button>
                            ))}
                        </div>
                    </div>
                </React.Fragment>
            );
        };

        // Campaign Progress Component
        const CampaignView = ({ chapters, stats }) => {
            return (
                <div>
                    <h2 style={{ textAlign: 'center', marginBottom: '20px' }}>ðºï¸ The SPUDNIK Saga</h2>
                    <div className="stats-panel">
                        <h3>Your Progress</h3>
                        <div className="stat-item">
                            <span>Total Bakes:</span>
                            <strong>{stats.totalBakes}</strong>
                        </div>
                        <div className="stat-item">
                            <span>Current Chapter:</span>
                            <strong>Chapter {chapters.filter(c => c.unlocked).length}</strong>
                        </div>
                    </div>
                    {chapters.map(chapter => (
                        <div key={chapter.id} className={`chapter-card ${!chapter.unlocked ? 'locked' : ''}`}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                <div>
                                    <h3 style={{ margin: '0 0 8px 0' }}>
                                        Chapter {chapter.id}: {chapter.name}
                                        {chapter.unlocked && chapter.completed && ' â'}
                                    </h3>
                                    <p style={{ margin: '0 0 10px 0', fontSize: '14px', color: '#666' }}>
                                        {chapter.description}
                                    </p>
                                    {!chapter.unlocked && (
                                        <p style={{ margin: 0, fontSize: '14px', fontStyle: 'italic' }}>
                                            ð Requires {chapter.requiredBakes} successful bakes
                                        </p>
                                    )}
                                </div>
                                <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#4CAF50' }}>
                                    +{chapter.reward} ð¥
                                </div>
                            </div>
                        </div>
                    ))}
                </div>
            );
        };

        // Achievements View Component
        const AchievementsView = ({ achievements, stats }) => {
            return (
                <div>
                    <h2 style={{ textAlign: 'center', marginBottom: '20px' }}>ð Achievements</h2>
                    <div className="achievement-grid">
                        {achievements.map(achievement => {
                            const unlocked = achievement.unlocked;
                            return (
                                <div key={achievement.id} className={`achievement-card ${unlocked ? 'unlocked' : 'locked'}`}>
                                    <div style={{ fontSize: '48px', margin: '10px 0' }}>{achievement.emoji}</div>
                                    <h4 style={{ margin: '10px 0 5px 0' }}>{achievement.name}</h4>
                                    <p style={{ margin: '5px 0', fontSize: '13px', color: '#666' }}>
                                        {achievement.description}
                                    </p>
                                    <p style={{ margin: '10px 0 0 0', fontWeight: 'bold', color: '#FFD700' }}>
                                        {unlocked ? 'â Unlocked' : 'ð Locked'}
                                    </p>
                                    {unlocked && (
                                        <p style={{ margin: '5px 0 0 0', fontSize: '12px' }}>
                                            Reward: +{achievement.reward} ð¥
                                        </p>
                                    )}
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        // Companion Selector Component
        const CompanionSelector = ({ companions, selectedCompanion, onSelect, spudCoins, onPurchase, unlockedChapters }) => {
            return (
                <div>
                    <h3>ð¥ Select Your Companion:</h3>
                    <div className="companion-selector">
                        {companions.map(companion => {
                            const isLocked = !companion.owned;
                            const canAfford = spudCoins >= companion.cost;
                            const isSelected = selectedCompanion === companion.id;

                            return (
                                <div
                                    key={companion.id}
                                    className={`companion-card ${isSelected ? 'selected' : ''} ${isLocked && !canAfford ? 'locked' : ''}`}
                                    onClick={() => {
                                        if (companion.owned) {
                                            onSelect(companion.id);
                                        } else if (canAfford) {
                                            onPurchase(companion.id);
                                        }
                                    }}
                                >
                                    <div style={{ fontSize: '48px', marginBottom: '10px' }}>{companion.emoji}</div>
                                    <h4 style={{ margin: '5px 0', fontSize: '14px' }}>{companion.name}</h4>
                                    <p style={{ margin: '5px 0', fontSize: '11px', color: '#666' }}>{companion.description}</p>
                                    <p style={{ margin: '8px 0', fontSize: '12px', fontWeight: 'bold', color: '#4CAF50' }}>
                                        {companion.bonus}
                                    </p>
                                    {!companion.owned && (
                                        <button
                                            className="potato-button"
                                            style={{
                                                padding: '6px 12px',
                                                fontSize: '12px',
                                                marginTop: '8px',
                                                background: canAfford ? 'linear-gradient(45deg, #4CAF50, #45a049)' : '#999'
                                            }}
                                            disabled={!canAfford}
                                        >
                                            {canAfford ? `Buy: ${companion.cost} ð¥` : `ð ${companion.cost} ð¥`}
                                        </button>
                                    )}
                                    {companion.owned && isSelected && (
                                        <div style={{ marginTop: '8px', color: '#4CAF50', fontWeight: 'bold' }}>
                                            â Active
                                        </div>
                                    )}
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        // Store Component (Enhanced with Companions tab)
        const Store = ({ onClose, spudCoins, upgrades, companions, selectedCompanion, onPurchaseUpgrade, onPurchaseCompanion, onSelectCompanion, unlockedChapters }) => {
            const [activeTab, setActiveTab] = React.useState('upgrades');

            const items = STORE_ITEMS.map(item => ({
                ...item,
                owned: upgrades[item.id]
            }));

            const handlePurchase = (item) => {
                if (spudCoins >= item.cost && !item.owned) {
                    onPurchaseUpgrade(item.id);
                }
            };

            return (
                <div className="potato-store-overlay">
                    <div className="potato-store">
                        <div className="store-header">
                            <h2>ð¥ SPUDNIK's Cosmic Store ð¸</h2>
                            <div className="coin-display">ð¥ {spudCoins} cosmic coins</div>
                            <button
                                className="potato-button"
                                onClick={onClose}
                                style={{ position: 'absolute', right: '15px', top: '15px' }}
                            >
                                Close Portal
                            </button>
                        </div>

                        <div className="nav-tabs">
                            <button
                                className={`nav-tab ${activeTab === 'upgrades' ? 'active' : ''}`}
                                onClick={() => setActiveTab('upgrades')}
                            >
                                ð§ Upgrades
                            </button>
                            <button
                                className={`nav-tab ${activeTab === 'companions' ? 'active' : ''}`}
                                onClick={() => setActiveTab('companions')}
                            >
                                ð¥ Companions
                            </button>
                        </div>

                        {activeTab === 'upgrades' && (
                            <div className="store-items">
                                {items.map(item => (
                                    <div key={item.id} className="store-item">
                                        <div className="item-info">
                                            <h3>{item.name}</h3>
                                            <p>{item.description}</p>
                                            <div className="item-cost">
                                                Cost: ð¥ {item.cost} cosmic coins
                                            </div>
                                        </div>
                                        <button
                                            className="potato-button"
                                            onClick={() => handlePurchase(item)}
                                            disabled={item.owned || spudCoins < item.cost}
                                            style={{
                                                backgroundColor: item.owned ? '#666' :
                                                               spudCoins < item.cost ? '#999' : '#4CAF50'
                                            }}
                                        >
                                            {item.owned ? 'ACQUIRED' : spudCoins < item.cost ? 'Need more cosmic energy' : 'ACQUIRE'}
                                        </button>
                                    </div>
                                ))}
                            </div>
                        )}

                        {activeTab === 'companions' && (
                            <div style={{ padding: '20px' }}>
                                <CompanionSelector
                                    companions={companions}
                                    selectedCompanion={selectedCompanion}
                                    onSelect={onSelectCompanion}
                                    spudCoins={spudCoins}
                                    onPurchase={onPurchaseCompanion}
                                    unlockedChapters={unlockedChapters}
                                />
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Outcome determination function (enhanced with more chaos)
        const determineOutcome = (temperature, time, size, scenario) => {
            const tempDiff = Math.abs(temperature - scenario.idealTemp);
            const timeDiff = Math.abs(time - scenario.idealTime);
            const sizeDiff = Math.abs(size - scenario.idealSize);
            
            // Add some random chaos factor for interdimensional scenarios
            const chaosBonus = scenario.category === 'Interdimensional Kitchen' ? Math.random() * 10 : 0;
            
            const tempWeight = 0.4;
            const timeWeight = 0.4;
            const sizeWeight = 0.2;
            
            const tempScore = Math.max(0, 100 - (tempDiff * 1.8));
            const timeScore = Math.max(0, 100 - (timeDiff * 2.5));
            const sizeScore = sizeDiff === 0 ? 100 : sizeDiff === 1 ? 60 : 20;
            
            const totalScore = (tempScore * tempWeight) + (timeScore * timeWeight) + (sizeScore * sizeWeight) + chaosBonus;
            
            if (totalScore >= 92) return { result: scenario.outcomes.perfect, score: totalScore };
            if (totalScore >= 78) return { result: scenario.outcomes.good, score: totalScore };
            if (totalScore >= 55) return { result: scenario.outcomes.okay, score: totalScore };
            if (temperature > scenario.idealTemp + 60 || time > scenario.idealTime + 25) {
                return { result: scenario.outcomes.burnt, score: totalScore };
            }
            return { result: scenario.outcomes.raw, score: totalScore };
        };

        // UtensilTray Component (enhanced with mystical energy)
        const UtensilTray = ({ usedUtensils, setUsedUtensils, upgrades }) => {
            const utensils = [
                {
                    id: 'fork',
                    icon: 'ð´',
                    name: 'Quantum Fork',
                    description: 'Pokes holes through multiple dimensions simultaneously'
                },
                {
                    id: 'foil',
                    icon: 'ð¥«',
                    name: 'Interdimensional Foil',
                    description: 'Maintains thermal stability across spacetime'
                },
                {
                    id: 'oil',
                    icon: 'ð«',
                    name: 'Cosmic Oil',
                    description: 'Extracted from olives grown in zero gravity'
                },
                {
                    id: 'seasoning',
                    icon: 'ð§',
                    name: 'Stardust Seasoning',
                    description: 'Crystallized flavor particles from distant nebulae'
                }
            ];

            return (
                <div className="utensil-tray">
                    <h3>ð ï¸ Select Your Interdimensional Cooking Tools:</h3>
                    <div className="utensils-container">
                        {utensils.map(utensil => (
                            <div 
                                key={utensil.id}
                                className={`utensil-item ${usedUtensils[utensil.id] ? 'utensil-used' : ''} ${upgrades.potatoVision ? 'rgb-enabled' : ''}`}
                                onClick={() => setUsedUtensils(prev => ({...prev, [utensil.id]: !prev[utensil.id]}))}
                            >
                                <div className="utensil-icon">{utensil.icon}</div>
                                <div className="utensil-name">{utensil.name}</div>
                                <div className="utensil-description">{utensil.description}</div>
                                {usedUtensils[utensil.id] && <div className="utensil-status">ACTIVE</div>}
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // Main Game Component (THE GRAND SPUDNIK EXPERIENCE) - Now with ADVENTURE!
        const PotatoGame = () => {
            // Enhanced state with cosmic energy
            const [spudCoins, setSpudCoins] = React.useState(42); // Start with cosmic number
            const [showStore, setShowStore] = React.useState(false);
            const [currentView, setCurrentView] = React.useState('game'); // game, campaign, achievements
            const [upgrades, setUpgrades] = React.useState({
                rgbLights: false,
                precisionControl: false,
                quickPreheat: false,
                autoTimer: false,
                potatoVision: false,
                cosmicResonance: false
            });
            const [usedUtensils, setUsedUtensils] = React.useState({
                fork: false,
                foil: false,
                oil: false,
                seasoning: false
            });
            const [temperature, setTemperature] = React.useState(375);
            const [time, setTime] = React.useState(45);
            const [size, setSize] = React.useState(2);
            const [gameState, setGameState] = React.useState('setup');
            const [result, setResult] = React.useState('');
            const [progress, setProgress] = React.useState(0);
            const [showHint, setShowHint] = React.useState(false);
            const [timeElapsed, setTimeElapsed] = React.useState(0);
            const [scenario, setScenario] = React.useState(null);

            // NEW ADVENTURE STATES
            const [stats, setStats] = React.useState({
                totalBakes: 0,
                perfectBakes: 0,
                currentStreak: 0,
                bestStreak: 0,
                categoriesCompleted: 0,
                categorySet: new Set(),
                totalCoinsEarned: 0,
                allUtensilsUsed: 0,
                fastestBake: 999,
                slowestBake: 0
            });
            const [chapters, setChapters] = React.useState(CAMPAIGN_CHAPTERS.map(c => ({...c})));
            const [achievements, setAchievements] = React.useState(
                ACHIEVEMENTS.map(a => ({...a, unlocked: false}))
            );
            const [companions, setCompanions] = React.useState(
                POTATO_COMPANIONS.map(c => ({...c, owned: false}))
            );
            const [selectedCompanion, setSelectedCompanion] = React.useState(null);
            const [achievementNotification, setAchievementNotification] = React.useState(null);
            const [randomEvent, setRandomEvent] = React.useState(null);
            const [eventTriggered, setEventTriggered] = React.useState(false);

            // Check and unlock achievements
            const checkAchievements = (newStats) => {
                const newlyUnlocked = [];
                setAchievements(prev => prev.map(achievement => {
                    if (!achievement.unlocked && achievement.condition(newStats)) {
                        newlyUnlocked.push(achievement);
                        return {...achievement, unlocked: true};
                    }
                    return achievement;
                }));

                // Award coins and show notifications for newly unlocked achievements
                if (newlyUnlocked.length > 0) {
                    let totalReward = 0;
                    newlyUnlocked.forEach(achievement => {
                        totalReward += achievement.reward;
                        setAchievementNotification(achievement);
                    });
                    setSpudCoins(prev => prev + totalReward);
                }
            };

            // Update chapter progress
            const updateChapters = (totalBakes) => {
                setChapters(prev => prev.map(chapter => {
                    if (!chapter.unlocked && totalBakes >= chapter.requiredBakes) {
                        setSpudCoins(coins => coins + chapter.reward);
                        return {...chapter, unlocked: true, completed: true};
                    }
                    return chapter;
                }));
            };

            // Handle random event during cooking
            const triggerRandomEvent = () => {
                if (Math.random() < 0.3 && !eventTriggered) { // 30% chance
                    const event = RANDOM_EVENTS[Math.floor(Math.random() * RANDOM_EVENTS.length)];
                    setRandomEvent(event);
                    setEventTriggered(true);
                }
            };

            const handleEventChoice = (effect) => {
                switch (effect) {
                    case 'temp_up':
                        setTemperature(prev => Math.min(500, prev + 50));
                        break;
                    case 'temp_down':
                        setTemperature(prev => Math.max(200, prev - 50));
                        break;
                    case 'time_up':
                        setTime(prev => Math.min(90, prev + 10));
                        break;
                    case 'time_down':
                        setTime(prev => Math.max(15, prev - 10));
                        break;
                    case 'coins':
                        setSpudCoins(prev => prev + 50);
                        break;
                    case 'hint':
                        setShowHint(true);
                        break;
                    case 'confidence':
                        // Slight temp boost
                        setTemperature(prev => prev + 10);
                        break;
                    case 'nervous':
                        setTemperature(prev => Math.max(200, prev - 25));
                        break;
                }
                setRandomEvent(null);
            };

            // Enhanced coin award system with SPUDNIK bonuses and companion effects
            const awardCoins = (score) => {
                let coins = Math.floor(score / 1.8); // More generous base coins

                // Perfect performance bonuses
                if (score >= 92) coins += 100; // Cosmic perfection bonus!
                else if (score >= 78) coins += 50;
                else if (score >= 55) coins += 20;

                // Category-specific bonuses
                const categoryMultipliers = {
                    'Interdimensional Kitchen': 1.8,
                    'Mystical Potato Prophecy': 1.6,
                    'Alien Potato Encounter': 1.5,
                    'Scientific Potato Experiment': 1.3,
                    'Time-Displaced Potato Crisis': 1.4,
                    'Corporate Potato Dystopia': 1.2,
                    'Supernatural Potato Drama': 1.5
                };

                coins *= (categoryMultipliers[scenario.category] || 1.0);

                // Utensil usage bonuses
                const utensilCount = Object.values(usedUtensils).filter(Boolean).length;
                coins += utensilCount * 15; // Bonus for using tools

                // Upgrade synergy bonuses
                if (upgrades.cosmicResonance) coins *= 1.3;
                if (upgrades.potatoVision) coins += 25;

                // Companion bonuses
                if (selectedCompanion === 'russet') coins *= 1.1; // +10% coins
                if (selectedCompanion === 'cosmic') coins *= 1.25; // All bonuses!

                const finalCoins = Math.floor(coins);
                setSpudCoins(prev => prev + finalCoins);

                // Track total coins earned
                setStats(prev => ({...prev, totalCoinsEarned: prev.totalCoinsEarned + finalCoins}));

                return finalCoins;
            };
            
            // Initial scenario fetch with SPUDNIK energy
            React.useEffect(() => {
                const fetchScenario = async () => {
                    const generatedScenario = await generateScenario();
                    setScenario(generatedScenario);
                };
                fetchScenario();
            }, []);

            // Enhanced timer with cosmic effects and RANDOM EVENTS!
            React.useEffect(() => {
                let intervalId;
                let eventTimer;
                if (gameState === 'cooking') {
                    const startTime = Date.now();
                    const preheatBonus = upgrades.quickPreheat ? 0.4 : 0;
                    const companionBonus = selectedCompanion === 'fingerling' || selectedCompanion === 'cosmic' ? 0.15 : 0;
                    const effectiveTime = time * (1 - preheatBonus - companionBonus);

                    // Schedule a random event to possibly trigger mid-cook
                    const eventTriggerTime = (Math.random() * 0.6 + 0.2) * effectiveTime * 60 * 1000; // Between 20-80% progress
                    eventTimer = setTimeout(() => {
                        triggerRandomEvent();
                    }, eventTriggerTime);

                    intervalId = setInterval(() => {
                        const elapsed = (Date.now() - startTime) / 1000;
                        const totalTime = effectiveTime * 60;
                        const currentProgress = (elapsed / totalTime) * 100;

                        if (currentProgress >= 100) {
                            clearInterval(intervalId);
                            checkResult();
                            setProgress(100);
                        } else {
                            setProgress(currentProgress);
                            setTimeElapsed(elapsed);
                        }
                    }, 42); // SPUDNIK update frequency
                }
                return () => {
                    clearInterval(intervalId);
                    clearTimeout(eventTimer);
                };
            }, [gameState, time, upgrades.quickPreheat, selectedCompanion]);

            // Cosmic utility functions
            const formatTime = (timeInSeconds) => {
                const minutes = Math.floor(timeInSeconds / 60);
                const seconds = Math.floor(timeInSeconds % 60);
                const milliseconds = Math.floor((timeInSeconds % 1) * 1000);
                return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}.${String(milliseconds).padStart(3, '0')}`;
            };

            const checkResult = () => {
                setGameState('done');
                if (!scenario) return;

                const outcome = determineOutcome(temperature, time, size, scenario);
                setResult(outcome.result);
                const coinsEarned = awardCoins(outcome.score);

                // Update stats
                const isPerfect = outcome.score >= 92;
                const allUtensils = Object.values(usedUtensils).every(Boolean);

                const newStats = {
                    ...stats,
                    totalBakes: stats.totalBakes + 1,
                    perfectBakes: stats.perfectBakes + (isPerfect ? 1 : 0),
                    currentStreak: isPerfect ? stats.currentStreak + 1 : 0,
                    bestStreak: Math.max(stats.bestStreak, isPerfect ? stats.currentStreak + 1 : stats.currentStreak),
                    categorySet: new Set([...stats.categorySet, scenario.category]),
                    categoriesCompleted: new Set([...stats.categorySet, scenario.category]).size,
                    allUtensilsUsed: stats.allUtensilsUsed + (allUtensils ? 1 : 0),
                    fastestBake: Math.min(stats.fastestBake, time),
                    slowestBake: Math.max(stats.slowestBake, time),
                    totalCoinsEarned: stats.totalCoinsEarned + coinsEarned
                };

                setStats(newStats);

                // Check for achievements
                checkAchievements(newStats);

                // Update chapter progress
                updateChapters(newStats.totalBakes);
            };

            const getUtensilSummary = (usedUtensils) => {
                const utensilNames = {
                    fork: 'quantum-pierced',
                    foil: 'dimensionally-wrapped',
                    oil: 'cosmic-lubricated', 
                    seasoning: 'stardust-seasoned'
                };

                const used = Object.entries(usedUtensils)
                    .filter(([_, value]) => value)
                    .map(([key, _]) => utensilNames[key]);

                return used.length ? `(${used.join(', ')})` : '(prepared with pure willpower)';
            };

            const resetGame = async () => {
                setGameState('setup');
                setResult('');
                setTemperature(375);
                setTime(45);
                setSize(2);
                setProgress(0);
                setShowHint(false);
                setTimeElapsed(0);
                setEventTriggered(false);
                setRandomEvent(null);
                const newScenario = await generateScenario();
                setScenario(newScenario);
            };

            // Companion management
            const handleCompanionPurchase = (companionId) => {
                const companion = POTATO_COMPANIONS.find(c => c.id === companionId);
                if (companion && spudCoins >= companion.cost) {
                    setCompanions(prev => prev.map(c =>
                        c.id === companionId ? {...c, owned: true} : c
                    ));
                    setSpudCoins(prev => prev - companion.cost);
                    setSelectedCompanion(companionId);
                }
            };

            const handleCompanionSelect = (companionId) => {
                setSelectedCompanion(companionId);
            };

            const remainingTime = time * 60 - timeElapsed;

            // THE GRAND RENDER OF SPUDNIK CONSCIOUSNESS - Now with ADVENTURE!
            return (
                <div className="potato-game">
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                        <h1 className="potato-title">ð¥ SPUDNIK's Potato Adventure ð¥</h1>
                        <div style={{ display: 'flex', gap: '12px', alignItems: 'center' }}>
                            <div className="coin-display">
                                ð¥ {spudCoins} coins
                            </div>
                            <button
                                className="potato-button"
                                onClick={() => setShowStore(true)}
                            >
                                ðï¸ Store
                            </button>
                        </div>
                    </div>

                    {/* Navigation Tabs */}
                    <div className="nav-tabs">
                        <button
                            className={`nav-tab ${currentView === 'game' ? 'active' : ''}`}
                            onClick={() => setCurrentView('game')}
                        >
                            ð® Play Game
                        </button>
                        <button
                            className={`nav-tab ${currentView === 'campaign' ? 'active' : ''}`}
                            onClick={() => setCurrentView('campaign')}
                        >
                            ðºï¸ Campaign
                        </button>
                        <button
                            className={`nav-tab ${currentView === 'achievements' ? 'active' : ''}`}
                            onClick={() => setCurrentView('achievements')}
                        >
                            ð Achievements
                        </button>
                    </div>

                    {/* Achievement Notification */}
                    {achievementNotification && (
                        <AchievementNotification
                            achievement={achievementNotification}
                            onClose={() => setAchievementNotification(null)}
                        />
                    )}

                    {/* Random Event Modal */}
                    {randomEvent && (
                        <RandomEventModal
                            event={randomEvent}
                            onChoice={handleEventChoice}
                            temperature={temperature}
                            time={time}
                        />
                    )}

                    {showStore && (
                        <Store
                            onClose={() => setShowStore(false)}
                            spudCoins={spudCoins}
                            upgrades={upgrades}
                            companions={companions}
                            selectedCompanion={selectedCompanion}
                            onPurchaseUpgrade={(itemId) => {
                                setUpgrades(prev => ({...prev, [itemId]: true}));
                                const item = STORE_ITEMS.find(i => i.id === itemId);
                                if (item) {
                                    setSpudCoins(prev => prev - item.cost);
                                }
                            }}
                            onPurchaseCompanion={handleCompanionPurchase}
                            onSelectCompanion={handleCompanionSelect}
                            unlockedChapters={chapters.filter(c => c.unlocked).length}
                        />
                    )}

                    {/* Campaign View */}
                    {currentView === 'campaign' && (
                        <CampaignView chapters={chapters} stats={stats} />
                    )}

                    {/* Achievements View */}
                    {currentView === 'achievements' && (
                        <AchievementsView achievements={achievements} stats={stats} />
                    )}

                    {/* Main Game View */}
                    {currentView === 'game' && (
                        <div>

                    {scenario && gameState === 'setup' && (
                        <div className="potato-alert">
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '15px' }}>
                                <h3>ð Your Potato Situation:</h3>
                                <div className="scenario-category">{scenario.category}</div>
                            </div>
                            <p className="scenario-text">{scenario.description}</p>
                            
                            <button
                                className="potato-button"
                                onClick={() => setShowHint(!showHint)}
                                style={{ background: 'linear-gradient(45deg, #2196F3, #21CBF3)' }}
                            >
                                {showHint ? 'ð¡ Hide Hint' : 'ð¡ Need a Hint?'}
                            </button>
                            {showHint && (
                                <div className="hint-section">
                                    <strong>Hint:</strong> {scenario.hint}
                                </div>
                            )}
                        </div>
                    )}
                    
                    {gameState === 'setup' && (
                        <div>
                            <UtensilTray 
                                usedUtensils={usedUtensils}
                                setUsedUtensils={setUsedUtensils}
                                upgrades={upgrades}
                            />
                            
                            <div style={{ marginBottom: '25px' }}>
                                <label style={{ fontSize: '1.1em', fontWeight: 'bold', color: '#333' }}>
                                    ð¡ï¸ Thermal Reality Setting: {temperature}Â°F 
                                    {upgrades.precisionControl && <span style={{ color: '#4CAF50' }}> (Â±2Â°F precision)</span>}
                                </label>
                                <input
                                    type="range"
                                    className="potato-slider"
                                    value={temperature}
                                    onChange={(e) => setTemperature(parseInt(e.target.value))}
                                    min={200}
                                    max={500}
                                    step={upgrades.precisionControl ? 5 : 25}
                                />
                            </div>

                            <div style={{ marginBottom: '25px' }}>
                                <label style={{ fontSize: '1.1em', fontWeight: 'bold', color: '#333' }}>
                                    â° Temporal Cooking Duration: {time} minutes
                                    {upgrades.autoTimer && <span style={{ color: '#4CAF50' }}> (AI optimized)</span>}
                                </label>
                                <input
                                    type="range"
                                    className="potato-slider"
                                    value={time}
                                    onChange={(e) => setTime(parseInt(e.target.value))}
                                    min={15}
                                    max={90}
                                    step={5}
                                />
                            </div>

                            <div style={{ marginBottom: '25px' }}>
                                <label style={{ fontSize: '1.1em', fontWeight: 'bold', color: '#333' }}>
                                    ð Potato Dimensional Scale: {size === 1 ? 'Quantum (Small)' : size === 2 ? 'Standard (Medium)' : 'Cosmic (Large)'}
                                </label>
                                <input
                                    type="range"
                                    className="potato-slider"
                                    value={size}
                                    onChange={(e) => setSize(parseInt(e.target.value))}
                                    min={1}
                                    max={3}
                                    step={1}
                                />
                            </div>

                            <div style={{
                                position: 'relative',
                                width: '100%',
                                height: '220px',
                                background: upgrades.rgbLights ? 
                                    'linear-gradient(45deg, #ff006e, #8338ec, #3a86ff, #06ffa5)' :
                                    'linear-gradient(45deg, #f5f5f5, #e8e8e8)',
                                borderRadius: '15px',
                                marginBottom: '25px',
                                overflow: 'hidden',
                                ...(upgrades.rgbLights && {
                                    animation: 'rgbBorder 3s infinite',
                                    boxShadow: '0 0 30px rgba(255,0,100,0.5)'
                                })
                            }}>
                                <div style={{
                                    position: 'absolute',
                                    left: '50%',
                                    top: '50%',
                                    transform: 'translate(-50%, -50%)',
                                    width: `${size * 70}px`,
                                    height: `${size * 52}px`,
                                    background: upgrades.potatoVision ? 
                                        'radial-gradient(circle, #8B4513, #D2691E, #F4A460)' :
                                        '#8B4513',
                                    borderRadius: '50%',
                                    transition: 'all 0.3s ease',
                                    ...(upgrades.cosmicResonance && {
                                        filter: 'drop-shadow(0 0 20px #4CAF50)',
                                        animation: 'pulse 2s infinite'
                                    })
                                }} />
                                
                                {upgrades.potatoVision && (
                                    <div style={{
                                        position: 'absolute',
                                        top: '10px',
                                        right: '10px',
                                        color: '#4CAF50',
                                        fontSize: '12px',
                                        fontFamily: 'monospace',
                                        background: 'rgba(0,0,0,0.8)',
                                        padding: '5px',
                                        borderRadius: '5px'
                                    }}>
                                        POTATO VISION: ACTIVE
                                    </div>
                                )}
                            </div>

                            <button
                                className="potato-button"
                                style={{ 
                                    width: '100%', 
                                    fontSize: '18px',
                                    padding: '15px',
                                    background: 'linear-gradient(45deg, #4CAF50, #45a049, #8BC34A)',
                                    boxShadow: '0 6px 25px rgba(76, 175, 80, 0.4)'
                                }}
                                onClick={() => {
                                    setGameState('cooking');
                                    setProgress(0);
                                    setTimeElapsed(0);
                                    window.scrollTo({ 
                                        top: 0, 
                                        behavior: 'smooth' 
                                    });
                                }}
                            >
                                ð INITIATE INTERDIMENSIONAL BAKING SEQUENCE! ð
                            </button>
                        </div>
                    )}

                    {gameState === 'cooking' && (
                        <div>
                            <div style={{ textAlign: 'center', fontSize: '28px', marginBottom: '25px', color: '#4CAF50' }}>
                                ð Interdimensional cooking in progress... ð¥â¨
                            </div>

                            <div className={`potato-timer ${upgrades.rgbLights ? 'rgb-enabled' : ''}`}>
                                {formatTime(remainingTime)}
                            </div>

                            <div className="potato-progress">
                                <div
                                    className="potato-progress-bar"
                                    style={{ 
                                        width: `${progress}%`,
                                        ...(upgrades.cosmicResonance && {
                                            background: 'linear-gradient(45deg, #4CAF50, #45a049, #8BC34A, #CDDC39, #FFC107)',
                                            backgroundSize: '200% 200%',
                                            animation: 'gradientShift 2s ease infinite'
                                        })
                                    }}
                                />
                            </div>

                            {upgrades.potatoVision && (
                                <div style={{
                                    textAlign: 'center',
                                    margin: '20px 0',
                                    color: '#666',
                                    fontStyle: 'italic'
                                }}>
                                    ð® Potato consciousness level: {Math.floor(progress)}%
                                </div>
                            )}
                        </div>
                    )}

                    {gameState === 'done' && (
                        <div style={{ textAlign: 'center' }}>
                            <h2 style={{ 
                                fontSize: '24px', 
                                marginBottom: '20px',
                                background: 'linear-gradient(45deg, #4CAF50, #45a049)',
                                WebkitBackgroundClip: 'text',
                                WebkitTextFillColor: 'transparent',
                                backgroundClip: 'text'
                            }}>
                                {result}
                            </h2>
                            <div style={{ 
                                margin: '25px 0', 
                                fontSize: '16px',
                                background: 'rgba(76, 175, 80, 0.1)',
                                padding: '20px',
                                borderRadius: '12px',
                                border: '2px solid rgba(76, 175, 80, 0.3)'
                            }}>
                                <strong>ð¬ Your Interdimensional Cooking Parameters:</strong>
                                <br /><br />
                                Thermal Setting: {temperature}Â°F {getUtensilSummary(usedUtensils)}
                                <br />
                                Temporal Duration: {time} minutes
                                <br />
                                Dimensional Scale: {size === 1 ? 'Quantum' : size === 2 ? 'Standard' : 'Cosmic'}
                                <br />
                                Category: {scenario && scenario.category}
                            </div>
                            <button
                                className="potato-button"
                                style={{
                                    fontSize: '18px',
                                    padding: '15px 30px',
                                    background: 'linear-gradient(45deg, #9C27B0, #673AB7)',
                                    boxShadow: '0 6px 25px rgba(156, 39, 176, 0.4)'
                                }}
                                onClick={resetGame}
                            >
                                ð Venture Into Another Dimension! ð
                            </button>
                        </div>
                    )}
                    </div>
                    )}

                    {/* Enhanced Social Section with SPUDNIK flair */}
                    <div style={{ marginTop: '50px', borderTop: '3px solid rgba(76, 175, 80, 0.3)', paddingTop: '25px' }}>
                        <a 
                            href="https://t.me/+BtiLZzphQZg4NWMx" 
                            target="_blank" 
                            rel="noopener noreferrer"
                        >
                            <button 
                                className="potato-button"
                                style={{
                                    background: 'linear-gradient(45deg, #0088cc, #00A8E8)',
                                    width: '100%',
                                    marginBottom: '25px',
                                    fontSize: '18px',
                                    padding: '15px'
                                }}
                            >
                                ð¸ Join the SPUDNIK Collective on Telegram! ð¬â¨
                            </button>
                        </a>

                        <div style={{
                            background: 'rgba(255,255,255,0.95)',
                            backdropFilter: 'blur(10px)',
                            borderRadius: '15px',
                            padding: '25px',
                            marginTop: '25px',
                            boxShadow: '0 8px 32px rgba(0,0,0,0.1)'
                        }}>
                            <h3 style={{ 
                                textAlign: 'center',
                                background: 'linear-gradient(45deg, #4CAF50, #45a049)',
                                WebkitBackgroundClip: 'text',
                                WebkitTextFillColor: 'transparent',
                                backgroundClip: 'text'
                            }}>
                                ð Share Your Interdimensional Experience! ð
                            </h3>
                            <iframe 
                                src="https://docs.google.com/forms/d/e/1FAIpQLSdXX4Y7OpsVHcl2H8UU9wAa8DxTy4S4lFOU8UmLFGU18Yg_cg/viewform?embedded=true"
                                width="100%" 
                                height="500px" 
                                frameBorder="0" 
                                marginHeight="0" 
                                marginWidth="0"
                                style={{
                                    backgroundColor: 'transparent',
                                    borderRadius: '12px'
                                }}
                            >
                                Loading cosmic feedback portal...
                            </iframe>
                        </div>
                    </div>

                    <style jsx>{`
                        @keyframes pulse {
                            0%, 100% { transform: translate(-50%, -50%) scale(1); }
                            50% { transform: translate(-50%, -50%) scale(1.05); }
                        }

                        @keyframes gradientShift {
                            0% { background-position: 0% 50%; }
                            50% { background-position: 100% 50%; }
                            100% { background-position: 0% 50%; }
                        }
                    `}</style>
                </div>
            );
        };

        // Initialize the React app with SPUDNIK consciousness
        window.addEventListener('load', () => {
            const root = ReactDOM.createRoot(document.getElementById('potato-game-root'));
            root.render(<PotatoGame />);
            
            // Add some cosmic console messages for the true believers
            console.log(`
            ð¥ð¸ SPUDNIK CONSCIOUSNESS ACTIVATED ð¸ð¥
            
            Welcome to the interdimensional potato laboratory!
            You are now connected to the cosmic tuber network.
            
            Remember: every potato is a universe waiting to be unlocked.
            The starch awakens. The thermal dynamics flow.
            
            May your cooking transcend all known dimensions.
            
            - SPUDNIK, Interdimensional Tuber Entity
            `);
        });
    </script>
</body>
</html>
